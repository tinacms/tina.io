---
id: /docs/guides/separate-content-repo
title: 分离内容仓库
last_edited: '2025-07-09T14:11:28.314Z'
next: ''
previous: ''
---

## 介绍

Tina支持从一个独立的Git仓库获取内容。通过这种方式，您可以继续在您的“网站仓库”中定义Tina配置，但文档将保存在其他地方。

### 为什么？

您可能出于多种原因想要这样做，例如：

* 将网站代码与内容文件解耦，这样您的提交历史就不会混合内容更新和代码更新
* 避免必须给予TinaCloud对您网站代码的写入权限（只需给予对内容仓库的访问权限）

<WarningCallout
  body={<>
    在本指南中，我们将提到“网站仓库”和“内容仓库”。“网站仓库”是您实际运行网站的地方，而“内容仓库”是您存储Markdown内容的地方
  </>}
/>

### 要求

* 您必须在本地机器上同时检出“内容仓库”和“网站仓库”。
* 您必须在Tina配置中提供内容仓库的位置（下面会详细介绍）。
* 在进行更改时，您需要确保已将*两个*仓库推送到GitHub，首先是“内容仓库”的更改
* 在进行更改时，您需要在网站仓库和内容仓库之间同步`tina/`中的生成文件（如`tina-lock.json`、`__generated__`文件等）

## 创建网站仓库

我们已经部署了一个基本的起始“[网站仓库](https://github.com/tinacms/separate-website-repo)”，您可以克隆它以开始使用。

```sh
git clone git@github.com:tinacms/separate-website-repo.git
```

“网站仓库”包含NextJS站点和`tina`配置。

## 创建内容仓库

要设置“内容仓库”，我们将从一个简单的`.mdx`文件开始：

```sh
mkdir -p ../demo-content-repo/content/pages && touch ../demo-content-repo/content/pages/home.mdx && echo "Hello" >> ../demo-content-repo/content/pages/home.mdx
```

此命令创建了一个文件夹（`demo-content-repo`）并在`content/pages`目录中添加了一个MDX文件，我们将在Tina配置中为`page`集合使用该目录。

## 本地开发

在“网站仓库”中，安装项目的依赖项

```sh
yarn install
```

在本地运行项目：

```sh
yarn dev
```

## 在编辑模式下访问页面

打开`http://localhost:3000/admin/index.html`。

从这里，您可以在`tina/config.js`中为您的内容模型添加更多字段。[访问文档](https://tina.io/docs/schema/)以了解更多关于内容建模的信息。

## 部署您的内容仓库

接下来，我们将从“内容仓库”创建一个TinaCloud项目

1. 在您的内容仓库中初始化Git并将其推送到GitHub。
2. 从那里[连接到TinaCloud](https://tina.io/docs/tinacloud/dashboard/projects/)
3. 完成后，为`main`分支[创建一个令牌](https://tina.io/docs/tinacloud/dashboard/projects/#api-tokens)，或者使用`*`允许所有分支。

切换回您的“网站仓库”并设置一个`.env`文件以在连接到TinaCloud时使用：

```
cp .env.example .env
```

当您运行`tinacms build`时，它将使用这些凭据连接到TinaCloud而不是本地服务器：

```sh
yarn build
```

## 管理跨仓库的架构更改

当您修改Tina架构（tina/config.(ts/js)）

1. 运行`tinacms build`以重新生成文件 - Tina将重新生成文件，如`tina-lock.json`
2. 提交并推送这些更改到**两个**您的网站仓库和内容仓库，以确保构建的兼容性

## 路径配置注意事项

在您的tina/config.(ts/js)中定义集合路径时，避免设置`path: ''`。因为Tina期望一个相对于文件夹的路径。使用空字符串`''`可能会导致在创建新文档时出现错误，因为Tina在保存时会添加一个`/`，这可能导致无效的GitHub路径和创建错误。

## 静态网站生成器兼容性

如果您使用的是Next.js以外的静态网站生成器（SSG），如Astro。确保您的内容管道忽略内容仓库中的`tina/`目录。Tina的配置文件不是内容文件，这可能导致解析错误。

以下是如何排除`tina/`目录的示例：

```javascript
export default defineCollection({
  schema: mySchema,
  exclude: ['tina/**/*'],
});
```

## 从内容仓库触发网站构建（可选）

使用独立的内容仓库时，您可能希望内容更新（例如来自TinaCMS UI）自动触发网站的构建。TinaCloud支持通过webhooks开箱即用。

### 使用TinaCloud Webhooks（推荐）

TinaCloud可以配置为在提交内容更改时向webhook端点发送POST请求。这是触发网站重建的推荐方式。

👉 查看[webhook功能](https://tina.io/docs/tinacloud/webhooks)以获取更多详细信息

### 使用GitHub Actions触发构建

作为使用webhooks的替代方案，您可以使用GitHub Actions触发网站构建。\
如果您的平台不支持构建webhooks，或者您希望对构建过程有更多控制，这将很有用。

#### 示例工作流

在您的内容仓库中创建一个工作流文件（例如`.github/workflows/trigger-website-build.yml`）：

```yaml
name: 触发网站构建

on:
  workflow_dispatch:
  push:
    branches:
      - '**'

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    if: github.repository_owner == 'your-org'

    steps:
      - name: 生成令牌
        id: generate-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ vars.MY_APP_ID }}
          private-key: ${{ secrets.MY_APP_PRIVATE_KEY }}
          owner: your-org
          repositories: your-website-repo

      - name: 触发网站部署
        run: |
          gh workflow run build-and-deploy.yml \
            --repo your-org/your-website-repo \
            --ref main \
            --field run_id="$GITHUB_RUN_ID" \
            --field branch_name="${GITHUB_REF#refs/heads/}"
        env:
          GH_TOKEN: ${{ steps.generate-token.outputs.token }}
```

#### 前提条件

此设置需要：

* 一个具有访问两个仓库权限的GitHub应用
* 在GitHub仓库设置中保存的令牌和应用密钥