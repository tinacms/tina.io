---
seo:
  description: >-
    å­¦ä¹ å¦‚ä½•åœ¨Next.js App Routerä¸­ä½¿ç”¨TinaCMSï¼ŒåŒ…æ‹¬è®¾ç½®ã€é…ç½®å’Œæœ€ä½³å®è·µï¼Œä»¥è·å¾—æµç•…çš„ç¼–è¾‘ä½“éªŒã€‚
title: Next.js App Router
last_edited: '2025-03-10T01:28:03.399Z'
next: content/docs-zh/frameworks/next/pages-router.mdx
previous: content/docs-zh/introduction/using-starter.mdx
---

> ğŸ‘†æœ¬æŒ‡å—å‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨**[Next.js app router.](https://nextjs.org/docs/app)**

## è§†é¢‘æŒ‡å—

<Youtube embedSrc="https://www.youtube.com/embed/0oYSzT1DDLg" />

## å®‰è£…ä¾èµ–

åœ¨æ‚¨ç½‘ç«™çš„ç›®å½•ä¸­è¿è¡Œï¼š

```bash
npx @tinacms/cli@latest init
```

è¿™å°†è¯¢é—®æ‚¨ä¸€äº›è®¾ç½®é—®é¢˜ã€‚å½“æç¤ºè¾“å…¥**å…¬å…±èµ„äº§ç›®å½•**æ—¶ï¼Œè¾“å…¥ï¼š**public**ã€‚

## æ›´æ–°æ„å»ºè„šæœ¬

`tina init` åº”è¯¥å·²ç»æ›´æ–°äº†æ‚¨çš„ `package.json` è„šæœ¬ã€‚

```json
"scripts": {
  "dev": "tinacms dev -c \"next dev\"",
  "build": "tinacms build && next build",
  "start": "tinacms build && next start"
}
```

å¦‚æœè¿™äº›æ²¡æœ‰è¢«CLIè®¾ç½®ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨åº”ç”¨ã€‚

## å¯åŠ¨TinaCMS

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨TinaCMSï¼š

```bash
pnpm dev
```

**æˆ‘ä»¬æ¨èä½¿ç”¨pnpmã€‚**

TinaCMSè¿è¡Œåï¼Œå¯¼èˆªåˆ° `http://localhost:3000/admin/index.html`ã€‚

> â“ æç¤ºï¼šå¦‚æœè¿è¡Œæ­¤å‘½ä»¤æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·å‚é˜…[å¸¸è§é”™è¯¯](/docs/forestry/common-errors)é¡µé¢ã€‚

æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°Tinaç®¡ç†ç•Œé¢ï¼Œé€‰æ‹©ä¸€ä¸ªå¸–å­ï¼Œä¿å­˜æ›´æ”¹ï¼Œå¹¶çœ‹åˆ°æ›´æ”¹æŒä¹…åŒ–åˆ°æ‚¨çš„æœ¬åœ°markdownæ–‡ä»¶ä¸­ã€‚

![TinaCMS ç®¡ç†ç•Œé¢æˆªå›¾](/img/hugo-tina-admin-screenshot.png)

## TinaCMS é…ç½®æ–‡ä»¶

è¿è¡Œ `tina init` å‘½ä»¤åï¼Œåˆ›å»ºäº†ä¸€äº›æ–‡ä»¶ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿå…¥é—¨ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯ `tina/config.ts` æ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå¿…éœ€çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†æ‰€æœ‰çš„tinaæ¨¡å¼ã€‚

å®ƒçœ‹èµ·æ¥å¦‚ä¸‹ï¼š

```ts
import { defineConfig } from 'tinacms';

// æ‚¨çš„æ‰˜ç®¡æä¾›å•†å¯èƒ½å°†æ­¤ä½œä¸ºç¯å¢ƒå˜é‡å…¬å¼€
const branch =
  process.env.GITHUB_BRANCH ||
  process.env.VERCEL_GIT_COMMIT_REF ||
  process.env.HEAD ||
  'main';

export default defineConfig({
  branch,

  // ä» tina.io è·å–
  clientId: process.env.NEXT_PUBLIC_TINA_CLIENT_ID,
  // ä» tina.io è·å–
  token: process.env.TINA_TOKEN,

  build: {
    outputFolder: 'admin',
    publicFolder: 'public',
  },
  media: {
    tina: {
      mediaRoot: '',
      publicFolder: 'public',
    },
  },
  schema: {
    collections: [
      {
        name: 'post',
        label: 'Posts',
        path: 'content/posts',
        fields: [
          {
            type: 'string',
            name: 'title',
            label: 'Title',
            isTitle: true,
            required: true,
          },
          {
            type: 'rich-text',
            name: 'body',
            label: 'Body',
            isBody: true,
          },
        ],
      },
    ],
  },
});
```

**æœ‰å…³é…ç½®çš„æ›´è¯¦ç»†æ¦‚è¿°ï¼Œè¯·å‚é˜…[ä½¿ç”¨TinaCMSè¿›è¡Œå†…å®¹å»ºæ¨¡](/docs/extending-tina/overview/)**

> ğŸ’¡ å¦‚æœæ‚¨æŒ‰ç…§æœ¬æŒ‡å—ä½¿ç”¨ `tina init` å‘½ä»¤ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°åˆ›å»ºäº†ä¸€ä¸ª `content` å’Œä¸€ä¸ª `pages` æ–‡ä»¶å¤¹ï¼š

```bash
Adding file at content/posts/hello-world.md... âœ…
Adding file at pages/demo/blog/[filename].tsx... âœ…
```

> è¿™äº›å¯ä»¥ç”¨ä½œå¿«é€Ÿå‚è€ƒï¼Œä½†å¯ä»¥å®‰å…¨åˆ é™¤ã€‚

## åˆ›å»ºæ–°å¸–å­

> ğŸ’¡ å¦‚ `tina/config.ts` æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º `post` çš„é›†åˆï¼ŒTinaCMSå°†ä¼šæ‹¾å–å¹¶æ˜ å°„åˆ°æ‚¨åœ¨TinaCMSç®¡ç†é¡µé¢ä¸­çœ‹åˆ°çš„å†…å®¹ã€‚

1. å‰å¾€ `/admin/index.html`

2. ç‚¹å‡» Posts

3. ç‚¹å‡» Create

4. è¾“å…¥å¿…å¡«å­—æ®µ

5. ä¿å­˜

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›å»æ£€æŸ¥åˆ›å»ºäº†ä»€ä¹ˆã€‚æ‚¨å°†çœ‹åˆ°ä¸€ä¸ª `/content` æ–‡ä»¶å¤¹ï¼Œæ‚¨çš„æ–°å¸–å­è¢«ä¿å­˜ä¸º `.md` æ–‡ä»¶ã€‚æ­¤è·¯å¾„åœ¨ `tina/config.ts` æ–‡ä»¶çš„posté›†åˆä¸­å®šä¹‰ï¼

```bash
content
    â””â”€â”€ posts
        â””â”€â”€ hello-world.md
```

## æ¸²æŸ“å¸–å­é›†åˆ

è®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ª `/posts` æ–‡ä»¶å¤¹å¼€å§‹ã€‚è¿™é‡Œçš„é¡µé¢å°†åˆ—å‡ºæˆ‘ä»¬æ‰€æœ‰çš„å¸–å­ã€‚

**æ–‡ä»¶ï¼š** `app/posts/page.tsx`

```tsx
import PostList from './client-page';
import { client } from '../../tina/__generated__/client';

export default async function Page() {
  const { data } = await client.queries.postConnection();

  return (
    <>
      <h1>Posts</h1>
      <div>
        {data.postConnection.edges.map((post) => (
          <div key={post.node.id}>
            <Link href={`/posts/${post.node._sys.filename}`}>
              {post.node._sys.filename}
            </Link>
          </div>
        ))}
      </div>
    </>
  );
}
```

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªæœåŠ¡å™¨æ¸²æŸ“çš„é¡µé¢ã€‚æ ¹æ®æ­¤é¡µé¢çš„ç”Ÿæˆæ–¹å¼ï¼ŒNextå°†ä¼šï¼š

- **A. å°†å…¶æ„å»ºä¸ºåŠ¨æ€/æœåŠ¡å™¨æ¸²æŸ“é¡µé¢**
- **B. å°†å…¶æ„å»ºä¸ºé™æ€é¡µé¢ã€‚**

è¿™å–å†³äºæ‚¨å¸Œæœ›å¦‚ä½•æ¸²æŸ“æ­¤é¡µé¢ã€‚

## æ¸²æŸ“å•ä¸ªå¸–å­

ä¸ºäº†ä½¿å…¶ä¸TinaCMSå¯è§†åŒ–ç¼–è¾‘å™¨ä¸€èµ·å·¥ä½œï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸ºä¸¤ä¸ªç»„ä»¶ã€‚ä¸€ä¸ªå°†åœ¨æ„å»ºæ—¶æ„å»ºé¡µé¢ï¼Œå¦ä¸€ä¸ªå°†æ˜¯ä¸€ä¸ªå¯ä»¥ä¸TinaCMSäº¤äº’å¹¶å·¥ä½œçš„å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ã€‚

**æ–‡ä»¶ï¼š** `app/posts/[...filename].tsx`

```tsx
import Post from './client-page';
import client from '../../../tina/__generated__/client';

export async function generateStaticParams() {
  const pages = await client.queries.postConnection();
  const paths = pages.data?.postConnection?.edges?.map((edge) => ({
    filename: edge?.node?._sys.breadcrumbs,
  }));

  return paths || [];
}

export default async function PostPage({
  params,
}: {
  params: { filename: string[] };
}) {
  const data = await client.queries.post({
    relativePath: `${params.filename}.md`,
  });

  return <Post {...data}></Post>;
}
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ [generateStaticParams](https://nextjs.org/docs/app/api-reference/functions/generate-static-params) å°†è¿™äº›é¡µé¢æ„å»ºä¸ºSSGã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦éšæ„æ›´æ”¹ã€‚

ç°åœ¨ï¼Œä¸ºäº†ä½¿å¯è§†åŒ–ç¼–è¾‘å™¨å·¥ä½œï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„â€œå®¢æˆ·ç«¯é¡µé¢â€ï¼š

**æ–‡ä»¶ï¼š** `app/posts/[...filename]/client-page.tsx`

```tsx
'use client';
import { useTina } from 'tinacms/dist/react';
import { PostQuery } from '../../../tina/__generated__/types';

interface ClientPageProps {
  query: string;
  variables: {
    relativePath: string;
  };
  data: PostQuery;
}

export default function Post(props: ClientPageProps) {
  // æ•°æ®åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ä¼ é€’ï¼Œå¹¶åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æ›´æ–°ä¸ºä¾§è¾¹æ æ•°æ®
  const { data } = useTina({
    query: props.query,
    variables: props.variables,
    data: props.data,
  });
  return (
    <code>
      <pre
        style={{
          backgroundColor: 'lightgray',
        }}
      >
        {JSON.stringify(data.post, null, 2)}
      </pre>
    </code>
  );
}
```

## å¸¸è§é—®é¢˜

### æ›´æ–°æœªæ­£ç¡®åæ˜ åœ¨é¡µé¢ä¸Š

åœ¨ä½¿ç”¨App Routerçš„Next.jsé¡¹ç›®ä¸­ä½¿ç”¨TinaCMSæ—¶ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°Vercelè¿‡åº¦ç¼“å­˜å†…å®¹å¯¼è‡´æŸäº›æ›´æ–°æœªæ­£ç¡®åæ˜ çš„æƒ…å†µã€‚

æ ¹æœ¬åŸå› æ˜¯ [Vercelæ•°æ®ç¼“å­˜](https://vercel.com/docs/data-cache) æ­£åœ¨ç¼“å­˜æ¥è‡ªTinaCloudå†…å®¹APIçš„å“åº”ã€‚è¿™å¯ä»¥é€šè¿‡æŸ¥è¯¢GraphQL APIå¹¶æŸ¥æ‰¾æ›´æ–°çš„å†…å®¹ï¼Œæˆ–è€…æ£€æŸ¥[Vercelä¸­ç¼“å­˜çš„ä½¿ç”¨æƒ…å†µ](https://vercel.com/docs/data-cache/manage-data-cache)æ¥ç¡®è®¤ã€‚

æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä¿®æ”¹æ‚¨çš„ç½‘ç«™ä»¥æœ€ä½³åœ°ä½¿ç”¨Vercelæ•°æ®ç¼“å­˜ï¼š

1. æ‰‹åŠ¨æ›´æ–°è·¯ç”±æ®µçš„é»˜è®¤é‡æ–°éªŒè¯æ—¶é—´ã€‚è¿™å°†å¯¼è‡´å¢é‡é™æ€ç”Ÿæˆåœ¨è¿è¡Œæ—¶é‡æ–°éªŒè¯ç¼“å­˜çš„å†…å®¹APIå“åº”æ—¶é‡å»ºé¡µé¢å¹¶æ›´æ–°å†…å®¹ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š[https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#revalidate](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#revalidate)
2. å‘æ‚¨çš„æŸ¥è¯¢ï¼ˆTinaCMSç”Ÿæˆï¼‰æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œä¾‹å¦‚ \
   `const response = await client.queries.page({ relativePath: 'pages/home.mdx'}, { fetchOptions: { next: { revalidate: 60 } })})`\
   è¿™å°†ä¼ é€’ç»™åº•å±‚çš„ `fetch` è¯·æ±‚ã€‚æœ‰å…³Next.jså¦‚ä½•æ‰©å±• `fetch` çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ï¼š[https://nextjs.org/docs/app/api-reference/functions/fetch](https://nextjs.org/docs/app/api-reference/functions/fetch)

### æ–°åˆ›å»ºçš„å†…å®¹é¡¹æœªå‡ºç°åœ¨é¡µé¢ä¸Š

åœ¨ä½¿ç”¨App Routerçš„Next.jsé¡¹ç›®ä¸­ä½¿ç”¨TinaCMSæ—¶ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°æ–°åˆ›å»ºçš„å†…å®¹é¡¹æœªç«‹å³å‡ºç°åœ¨ç›¸åº”é¡µé¢ä¸Šçš„æƒ…å†µã€‚è¿™ç§è¡Œä¸ºé€šå¸¸æ˜¯ç”±Next.jså’Œæµè§ˆå™¨é‡‡ç”¨çš„æ¿€è¿›ç¼“å­˜æœºåˆ¶å¼•èµ·çš„ã€‚

ä¸ºäº†ç¡®ä¿åœ¨æœ¬åœ°å¼€å‘æœŸé—´çœ‹åˆ°æœ€æ–°çš„å†…å®¹ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ä¸­ç¦ç”¨æµè§ˆå™¨ç¼“å­˜ï¼š

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆä¾‹å¦‚ï¼ŒChromeï¼ŒFirefoxï¼‰ã€‚
2. å¯¼èˆªåˆ°ç½‘ç»œé€‰é¡¹å¡ã€‚
3. å‹¾é€‰ç¦ç”¨ç¼“å­˜é€‰é¡¹ï¼ˆæ­¤è®¾ç½®åœ¨å¼€å‘è€…å·¥å…·æ‰“å¼€æ—¶æœ‰æ•ˆï¼‰ã€‚

\
![åœ¨å¼€å‘è€…å·¥å…·ä¸­ç¦ç”¨ç¼“å­˜](/img/docs/frameworks/next/app-router/devtools-disabling-cache.png)

\
æœ‰å…³Next.jsä¸­ç¼“å­˜çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Next.jså®˜æ–¹æ–‡æ¡£ï¼š
[Next.jsç¼“å­˜æ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/caching)

## ä¸‹ä¸€æ­¥

- [æŸ¥çœ‹å†…å®¹å»ºæ¨¡æ–‡æ¡£](/docs/schema/)
- [äº†è§£å¦‚ä½•æŸ¥è¯¢æ‚¨çš„å†…å®¹](/docs/features/data-fetching/)
- [éƒ¨ç½²æ‚¨çš„ç½‘ç«™](/docs/tina-cloud)